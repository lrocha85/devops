pipeline {
    agent {
        label 'master'
    }

    	environment {
		DOCKERHUB_CREDENTIALS=credentials('devops_estudo')
	}


    stages{
        stage('Clone repository') {
            steps{
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], browser: [$class: 'GithubWeb', repoUrl: ''], extensions: [], userRemoteConfigs: [[credentialsId: 'ad5e43fe-91f3-494d-ae27-5cee8d0f49cb', url: 'https://github.com/lrocha85/devops.git']]])
            }
            
        }

        stage('Build') {
            steps{
                sh 'docker build -t lrocha85/estudo/brasileirao_image:latest .'
            }
        }
        stage('Login to dockerhub') {
            steps{
                sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
            }    
        }
        stage('Push image') {
            steps{
                sh 'docker push lrocha85/estudo/brasileirao_image:latest'
            }           
            
        }
    }
}